
Loading of the data in preparation for model runs

   # Calculate/check the Analysis area, Study area and Background file area

   # Load the Background file, make a list of all non-(near)-zero cell coords, locations and values

   # Load the Origin data, filter values to the Study area, calculate age-band populations

   # Load the Destination data, filter values to the Study area, calculate age-band populations

   # Load the Timeseries data
   

Description of the algorithm implemented by the modelRun class (work in progress)

   # make a copy of the origin total pop array for this ageband

   # loop through each destination collection

   #     loop through each destination row in the collection

   #         grab the time profile for this collection

   #            (if changed) find the on site / in travel % for the specified time (from timeseries)

   #         grab the population for the specified ageband
   #            (calculated on load, using the total pop and ageband percentages)

   #             calculate for destination required OnSite Pop / InTravel Pop


   #             Major Flows first
   #               if any, loop through each MF for this destination
   #                   percentage of onSite/inTravel required -> numbers to remove
   #                   find list of origins providing these values, and pop count
   #                   add origins to list of MF origins affected by this dest
   #                      for each origin in the list
   #                         calc ratio of origin pop to pop total
   #                         subtract proportion from origins
   #                         subtract from required pop onSite/inTravel

   #             loop through each WAD pair (note nearest always first)
   #                 add empty origin pop count and origin list to each WAD list

   #             loop through each origin
   #                 ignore if in list of MF origins affected by this dest
   #                 calculate distance to current destination
   #                   work through WADs stepping through smallest to largest radius
   #                   add index to origin list for smallest matching WAD 
   #                   update (origins) pop total for corresponding matching WAD

   #             loop through each WAD pair again, smallest to largest radius
   #                 for each one with total origin pop > 0
   #                    for each origin in the list
   #                       calc ratio of origin pop to total orig pop
   #                       remove proportion from origins
   #                       remove from WAD pop total
   #                         pass pop total to next WAD (or pull from next)
   #                         pass origins to next WAD (or pull from next)


# (NO!) remove from inTravel/onSite grids


inTravel grid creation:

   # for each dest array item inTravel value
   #    for each wad (rad:pc)
   #       allocate non-zero background cells (within radius) and total bg amount into each wad
   #
   #    for each wad (pc)
   #       -> amount within this radius
   #            for each contained background cell
   #                add to same location in new grid:
   #                    dest pop * wad pc * background weighting /  total weighting



# check when to sample!!!??
